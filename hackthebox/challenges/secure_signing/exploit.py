import socket
import time
from hashlib import sha256


KNOWN_FLAG = b""
SERVER = ("206.189.27.45", 30289)

SOCKET = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
SOCKET.connect(SERVER)
SOCKET.recv(2048) # receive initial message

def H(m):
    return sha256(m).digest()

def sign(message):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(SERVER)
    s.recv(2048) # receive initial message
    s.send(b"1\n")
    s.recv(1024)
    s.send(message)
    time.sleep(1)
    signed = s.recv(1024).split(b"Hash: ")[1].split(b"\n")[0]
    return signed



cracked_byte = True

while cracked_byte:
    cracked_byte = False
    sig = sign(bytes(len(KNOWN_FLAG) + 1) + b"\n")
    for i in range(256):
        h = H(KNOWN_FLAG + bytes([i])).hex().encode()
        if h == sig:
            KNOWN_FLAG = KNOWN_FLAG + bytes([i])
            print(KNOWN_FLAG)
            cracked_byte = True
            break

exit(0)

# Connect to the server
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(SERVER)
print(s.recv(2048))
s.send(b"1\n")
print(s.recv(1024))
s.send(b"a\n")
print(s.recv(1024))
